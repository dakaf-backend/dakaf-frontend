<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-8">

  <h1 class="text-3xl font-bold mb-6 text-center">Admin Product Upload</h1>

  <!-- Admin Upload Form -->
<form id="uploadForm" enctype="multipart/form-data">
  <div class="mb-4">
    <label class="block text-gray-700 font-bold mb-2" for="name">
      Product Name
    </label>
    <input
      type="text"
      id="name"
      name="name"
      required
      class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
  </div>

  <div class="mb-4">
    <label class="block text-gray-700 font-bold mb-2" for="price">
      Product Price
    </label>
    <input
      type="number"
      id="price"
      name="price"
      required
      class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
    />
  </div>

  <div class="mb-4">
    <label class="block text-gray-700 font-bold mb-2" for="image">
      Product Image
    </label>
    <!-- ⚡ The magic part -->
    <input
      type="file"
      id="image"
      name="image"
      accept="image/*"
      required
      class="w-full"
    />
    <!-- Optional preview -->
    <img id="preview" class="hidden mt-3 h-32 rounded-lg border" />
  </div>

  <button
    type="submit"
    class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
  >
    Upload Product
</button>
  
    <p id="msg" class="text-center mt-4 text-green-600"></p>
    <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded">Logout</button>
  </div>

  <div id="adminProducts" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

<script>
   // Preview selected image (optional but recommended)
   const imageInput = document.getElementById("image");
  const preview = document.getElementById("preview");

  imageInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (!file) return;

    preview.src = URL.createObjectURL(file);
    preview.classList.remove("hidden");
  });

  // Example JS: submit form to backend
  const form = document.getElementById("uploadForm");
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const res = await fetch("https://dakaf-backend.onrender.com/products", {
        method: "POST",
        body: formData
      });
      const data = await res.json();
      alert(data.message);
    } catch (err) {
      console.error(err);
      alert("Error uploading product");
    }
  });

//⚡ Key points that fix the mobile issue
async function loadAdminProducts() {
  const res = await fetch("https://dakaf-backend.onrender.com/products");
  const products = await res.json();
  const container = document.getElementById("adminProducts");
  container.innerHTML = "";

  products.forEach(p => {
    container.innerHTML += `
      <div class="bg-white p-4 rounded shadow flex flex-col items-center">
        <img src="https://dakaf-backend.onrender.com${p.image}" class="h-40 w-full object-cover rounded mb-2">
        <h2 class="font-semibold text-lg">${p.name}</h2>
        <p class="font-bold text-blue-600">₦${p.price}</p>
        <div class="flex gap-2 mt-2">
          <button onclick='editProduct(${p.id})' class="bg-yellow-500 text-white px-3 py-1 rounded">Edit</button>
          <button onclick='deleteProduct(${p.id})' class="bg-red-600 text-white px-3 py-1 rounded">Delete</button>
        </div>
      </div>
    `;
  });
}

async function deleteProduct(id) {
  if (!confirm("Are you sure you want to delete this product?")) return;

  await fetch(`https://dakaf-backend.onrender.com/products/${id}`, { method: "DELETE" });
  alert("Product deleted");
  loadAdminProducts();
}

async function editProduct(id) {
  const name = prompt("Enter new product name:");
  const price = prompt("Enter new price:");

  const formData = new FormData();
  formData.append("name", name);
  formData.append("price", price);

  // Optional: upload new image via file input
  // const fileInput = document.createElement("input");
  // fileInput.type = "file";
  // fileInput.onchange = () => { formData.append("image", fileInput.files[0]); }

  await fetch(`https://dakaf-backend.onrender.com/products/${id}`, { method: "PUT", body: formData });
  alert("Product updated");
  loadAdminProducts();
}

loadAdminProducts();

    const API = "https://dakaf-backend.onrender.com";
  
    document.getElementById("productForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const formData = new FormData();
      formData.append("name", document.getElementById("name").value);
      formData.append("price", document.getElementById("price").value);
      formData.append("image", document.getElementById("image").files[0]);
  
      const res = await fetch(API + "/products", {
        method: "POST",
        body: formData
      });
  
      const data = await res.json();
      alert(data.message);
    });

  
    function logout(){
      localStorage.clear();
      window.location.href = "login_page.html";
    }
  </script>

</body>
</html>
